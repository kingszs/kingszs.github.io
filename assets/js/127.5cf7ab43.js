(window.webpackJsonp=window.webpackJsonp||[]).push([[127],{704:function(t,a,s){"use strict";s.r(a);var r=s(11),e=Object(r.a)({},(function(){var t=this,a=t.$createElement,s=t._self._c||a;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("h1",{attrs:{id:"微信小程序实现微信登录"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微信小程序实现微信登录"}},[t._v("#")]),t._v(" 微信小程序实现微信登录")]),t._v(" "),s("h3",{attrs:{id:"微信小程序提供了wx-getuserprofile-方法实现获取微信用户信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微信小程序提供了wx-getuserprofile-方法实现获取微信用户信息"}},[t._v("#")]),t._v(" 微信小程序提供了"),s("code",[t._v("wx.getUserProfile()")]),t._v("方法实现获取微信用户信息")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("wx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("getUserProfile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("desc")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'告诉用户为何需要用户信息'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//字符串不能超出限制 不然会报错")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//获取结果")]),t._v("\n        console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"实现步骤"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现步骤"}},[t._v("#")]),t._v(" 实现步骤：")]),t._v(" "),s("h4",{attrs:{id:"_1-为test绑定tap事件-在时间处理函数中调用该方法获取用户信息。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-为test绑定tap事件-在时间处理函数中调用该方法获取用户信息。"}},[t._v("#")]),t._v(" 1.为"),s("code",[t._v("test")]),t._v("绑定"),s("code",[t._v("tap")]),t._v("事件，在时间处理函数中调用该方法获取用户信息。")]),t._v(" "),s("h4",{attrs:{id:"_2-获取用户信息后-更新界面。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-获取用户信息后-更新界面。"}},[t._v("#")]),t._v(" 2.获取用户信息后，更新界面。")]),t._v(" "),s("h3",{attrs:{id:"微信登录业务流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#微信登录业务流程"}},[t._v("#")]),t._v(" 微信登录业务流程")]),t._v(" "),s("p",[t._v("用户通过微信提供的API执行登录业务，获取昵称和头像等用户信息。")]),t._v(" "),s("p",[t._v("一定要将用户信息存入自己家的数据库中。（"),s("code",[t._v("mysql")]),t._v("，云数据库）")]),t._v(" "),s("table",[s("thead",[s("tr",[s("th",[t._v("id")]),t._v(" "),s("th",[s("code",[t._v("nickName")])]),t._v(" "),s("th",[s("code",[t._v("avatarUrl")])])])]),t._v(" "),s("tbody",[s("tr",[s("td",[t._v("1")]),t._v(" "),s("td",[s("code",[t._v("yuanwei")])]),t._v(" "),s("td",[t._v("https://xxxxxx")])])])]),t._v(" "),s("h6",{attrs:{id:"这样未来才可以对自己家的数据库中的用户信息进行管理-删、改、查"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#这样未来才可以对自己家的数据库中的用户信息进行管理-删、改、查"}},[t._v("#")]),t._v(" 这样未来才可以对自己家的数据库中的用户信息进行管理（删、改、查）")]),t._v(" "),s("h4",{attrs:{id:"实现步骤-2"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现步骤-2"}},[t._v("#")]),t._v(" "),s("code",[t._v("实现步骤")])]),t._v(" "),s("h4",{attrs:{id:"_1-创建一个新的云数据集合-users-用于存储用户信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-创建一个新的云数据集合-users-用于存储用户信息"}},[t._v("#")]),t._v(" 1.创建一个新的云数据集合："),s("code",[t._v("users")]),t._v(",用于存储用户信息")]),t._v(" "),s("h4",{attrs:{id:"_2-当微信登录成功后-执行-注册业务-将用户信息存入到users集合中。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-当微信登录成功后-执行-注册业务-将用户信息存入到users集合中。"}},[t._v("#")]),t._v(" 2.当微信登录成功后，执行”注册业务“，将用户信息存入到"),s("code",[t._v("users")]),t._v("集合中。")]),t._v(" "),s("h4",{attrs:{id:"_3-当下次登录时-提供了权限后-去自己家users集合中找一找有没有当前用户信息"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-当下次登录时-提供了权限后-去自己家users集合中找一找有没有当前用户信息"}},[t._v("#")]),t._v(" 3.当下次登录时，提供了权限后，去自己家"),s("code",[t._v("users")]),t._v("集合中找一找有没有当前用户信息：")]),t._v(" "),s("h5",{attrs:{id:"_1-如果有-则直接获取最新信息-更新界面。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-如果有-则直接获取最新信息-更新界面。"}},[t._v("#")]),t._v(" 1.如果有，则直接获取最新信息，更新界面。")]),t._v(" "),s("h5",{attrs:{id:"_2-如果没有则想users集合中新增用户"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-如果没有则想users集合中新增用户"}},[t._v("#")]),t._v(" 2.如果没有则想"),s("code",[t._v("users")]),t._v("集合中新增用户")]),t._v(" "),s("h4",{attrs:{id:"实现修改头像功能"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#实现修改头像功能"}},[t._v("#")]),t._v(" 实现修改头像功能")]),t._v(" "),s("h5",{attrs:{id:"简易版实现流程"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#简易版实现流程"}},[t._v("#")]),t._v(" 简易版实现流程")]),t._v(" "),s("h6",{attrs:{id:"_1-点击头像后-跳转到新的页面选择新头像图片。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-点击头像后-跳转到新的页面选择新头像图片。"}},[t._v("#")]),t._v(" 1.点击头像后，跳转到新的页面选择新头像图片。")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("wx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("chooseImage")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h6",{attrs:{id:"_2-选择完毕后-点击确定-获取选中的头像图片路径-更新界面。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-选择完毕后-点击确定-获取选中的头像图片路径-更新界面。"}},[t._v("#")]),t._v(" 2.选择完毕后，点击确定，获取选中的头像图片路径，更新界面。")]),t._v(" "),s("h4",{attrs:{id:"标准版实现方式"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#标准版实现方式"}},[t._v("#")]),t._v(" 标准版实现方式")]),t._v(" "),s("p",[t._v("想要随时可以看到以前修改过的头像，就必须将新头像存入数据库中，所以需要去一个可以随时访问的外链地址，将该地址存放到数据库才可以")]),t._v(" "),s("h6",{attrs:{id:"_1-将选择的图片上传到云存储空间-并获取访问地址。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-将选择的图片上传到云存储空间-并获取访问地址。"}},[t._v("#")]),t._v(" 1.将选择的图片上传到云存储空间，并获取访问地址。")]),t._v(" "),s("h6",{attrs:{id:"_2-将访问地址更新到云数据库中。userinfo-avatarurl"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-将访问地址更新到云数据库中。userinfo-avatarurl"}},[t._v("#")]),t._v(" 2.将访问地址更新到云数据库中。"),s("code",[t._v("userInfo.avatarUrl")])]),t._v(" "),s("h6",{attrs:{id:"_3-下次登录时-直接访问users集合-拿到的路径就是最新的云存储头像路径-这样就可以访问到新头像了。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-下次登录时-直接访问users集合-拿到的路径就是最新的云存储头像路径-这样就可以访问到新头像了。"}},[t._v("#")]),t._v(" 3.下次登录时，直接访问"),s("code",[t._v("users")]),t._v("集合，拿到的路径就是最新的云存储头像路径，这样就可以访问到新头像了。")]),t._v(" "),s("h3",{attrs:{id:"云存储"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#云存储"}},[t._v("#")]),t._v(" 云存储")]),t._v(" "),s("p",[t._v("云开发提供了一块存储空间，提供了上传文件到云端、带权限管理的云端下载能力，开发者可以在小程序和云函数端通过"),s("code",[t._v("API")]),t._v("使用云存储功能")]),t._v(" "),s("p",[t._v("在小程序端可以分别调用"),s("code",[t._v("wx.cloud.uploadFile")]),t._v("和"),s("code",[t._v("wx.cloud.downloadFile")]),t._v("完成上传和下载文件的操作。")]),t._v(" "),s("p",[t._v("下面简单的几行代码，即可以实现小程序内让用户选择一张图片，然后上传到云端管理的功能：")]),t._v(" "),s("div",{staticClass:"language-javascript extra-class"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("wx"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("cloud"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("uploadFile")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("filePath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"本地文件路径"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token literal-property property"}},[t._v("cloudPath")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v('"云端文件路径（注意防止命名重复）"')]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token function-variable function"}},[t._v("success")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v(":")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("res")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n        "),s("span",{pre:!0,attrs:{class:"token comment"}},[t._v("//...返回上传结果：包含访问地址")]),t._v("\n        console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("res"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n    "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n    \n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n")])])]),s("h3",{attrs:{id:"云函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#云函数"}},[t._v("#")]),t._v(" 云函数")]),t._v(" "),s("p",[t._v("云函数是一段运行在云端的代码，无需要管理，在开发工具内编译、一键上传即可以运行的后端代码。")]),t._v(" "),s("p",[t._v("小程序内提供了专门用于云函数调用的"),s("code",[t._v("API")]),t._v("。开发者可以在云函数内使用"),s("code",[t._v("wx.server-sdk")]),t._v("提供的"),s("code",[t._v("getWXContext")]),t._v("方法获取每次调用的上下文("),s("code",[t._v("appid")]),t._v("、"),s("code",[t._v("openid")]),t._v("等)，无需维护复杂的鉴权机制，即可获取天然可信任的用户登录态("),s("code",[t._v("openid")]),t._v(")")]),t._v(" "),s("h3",{attrs:{id:"使用云函数"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#使用云函数"}},[t._v("#")]),t._v(" 使用云函数")]),t._v(" "),s("h4",{attrs:{id:"_1-在小程序开发工具中cloudfunction目录下-新建云函数。右键cloudfunction-设置云函数名称"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_1-在小程序开发工具中cloudfunction目录下-新建云函数。右键cloudfunction-设置云函数名称"}},[t._v("#")]),t._v(" 1.在小程序开发工具中"),s("code",[t._v("cloudFunction")]),t._v("目录下，新建云函数。右键"),s("code",[t._v("cloudFunction")]),t._v("，设置云函数名称")]),t._v(" "),s("h4",{attrs:{id:"_2-编写云函数代码。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_2-编写云函数代码。"}},[t._v("#")]),t._v(" 2.编写云函数代码。")]),t._v(" "),s("h4",{attrs:{id:"_3-在小程序开发工具中一键部署云端。右键云函数文件夹-选择上传并部署-云端安装依赖。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_3-在小程序开发工具中一键部署云端。右键云函数文件夹-选择上传并部署-云端安装依赖。"}},[t._v("#")]),t._v(" 3.在小程序开发工具中一键部署云端。右键云函数文件夹，选择上传并部署：云端安装依赖。")]),t._v(" "),s("h4",{attrs:{id:"_4-在小程序端-使用wx-cloud-callfunction-进行云函数的调用。"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#_4-在小程序端-使用wx-cloud-callfunction-进行云函数的调用。"}},[t._v("#")]),t._v(" 4.在小程序端（使用"),s("code",[t._v("wx.cloud.callFunction()")]),t._v("）进行云函数的调用。")])])}),[],!1,null,null,null);a.default=e.exports}}]);